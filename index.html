<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tactical Battle Board</title>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
        }
      }
    </script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app">
      <header class="panel header">
        <div class="header-left">
          <div class="role-badge" id="role-badge">Role: --</div>
          <div class="cam-buttons header-cams">
            <button data-cam-slot="1">View 1</button>
            <button data-cam-slot="2">View 2</button>
            <button data-cam-slot="3">View 3</button>
            <button data-cam-slot="4">View 4</button>
            <button data-cam-slot="5">View 5</button>
            <button data-cam-slot="6">View 6</button>
            <button id="clear-cam-views">Clear Views</button>
          </div>
        </div>
        <div class="header-right">
          <div class="actions header-actions">
            <button id="log-open">Open Log</button>
            <button id="db-open">Open DB</button>
            <button id="tokens-open">Open Tokens</button>
            <button id="scripts-open">Scripts</button>
            <button id="params-open">View Parameters</button>
            <button id="lang-open">Battle Language</button>
            <button id="selection-open">Selection</button>
            <button id="turn-open">Turn Actions</button>
            <button id="view-toggle">View</button>
          </div>
        </div>
      </header>


      <section class="panel map-panel">
        <canvas id="map-canvas"></canvas>
      </section>

    </main>

    <div id="log-window" class="log-window">
      <div class="log-window-header">
        <div class="log-window-header-top">
          <span>Log</span>
          <div class="log-actions">
            <button id="log-clear">Clear</button>
            <button id="log-copy">Copy</button>
          </div>
          <button id="log-close">Close</button>
        </div>
        <div class="log-window-header-bottom log-filters"></div>
      </div>
      <div id="log" class="log-body"></div>
    </div>

    <div id="db-window" class="db-window">
      <div class="db-window-header">
        <span>Local Storage</span>
        <button id="db-close">Close</button>
      </div>
      <div id="db-body" class="db-body"></div>
    </div>

    <div id="tokens-window" class="tokens-window">
      <div class="tokens-window-header">
        <span>Active Tokens</span>
        <div class="token-actions">
          <button id="tokens-copy">Copy IDs</button>
        </div>
        <button id="tokens-close">Close</button>
      </div>
      <div id="tokens-body" class="tokens-body"></div>
      <div class="tokens-window-resize" aria-label="Resize tokens window"></div>
    </div>

    <div id="turn-window" class="turn-window">
      <div class="turn-window-header">
        <span>Turn Actions</span>
        <button id="turn-close">Close</button>
      </div>
      <div class="turn-body">
        <div class="turn-meta">
          <div class="turn-round">Round --</div>
          <div class="turn-active">Active: --</div>
        </div>
        <div class="turn-actions">
          <button id="turn-roll-init">Roll Initiative</button>
        </div>
        <textarea class="turn-info" readonly></textarea>
        <div class="turn-details"></div>
        <div class="turn-suggestions"></div>
      </div>
      <div class="turn-window-resize" aria-label="Resize turn window"></div>
    </div>

    <div id="scripts-window" class="scripts-window">
      <div class="scripts-window-header">
        <span>Scripts</span>
        <button id="scripts-close">Close</button>
      </div>
      <div class="scripts-window-body">
        <div class="scripts-actions">
          <label class="test-toggle"><input type="checkbox" id="show-test-dirs" /> Test Dirs</label>
          <button id="scripts-run-selected">Run Selected</button>
          <button id="scripts-run-editor">Run Editor Script</button>
        </div>
        <div id="script-tree-scroll" class="tree-scroll">
          <div id="script-tree" class="script-tree" aria-label="Script list"></div>
        </div>
      </div>
      <div class="scripts-window-resize" aria-label="Resize scripts window"></div>
    </div>

    <div id="lang-window" class="lang-window">
      <div class="lang-window-header">
        <span>Battle Language</span>
        <button id="lang-close">Close</button>
      </div>
      <div class="lang-body">
        <div class="actions">
          <button id="run-btn">Run Script</button>
          <button id="run-selected-btn">Run Selected</button>
          <button id="clear-btn">Clear Tokens</button>
        </div>
        <textarea id="script-input" class="console" spellcheck="false"></textarea>
      </div>
      <div class="lang-window-resize" aria-label="Resize battle language window"></div>
    </div>

    <div id="params-window" class="params-window">
      <div class="params-window-header">
        <span>View Parameters</span>
        <button id="params-close">Close</button>
      </div>
      <div class="params-body">
        <div class="field slider-field">
          <label for="move-speed-scale">Move speed</label>
          <input id="move-speed-scale" type="range" min="0.1" max="2" step="0.05" value="1" />
          <span class="slider-value" id="move-speed-scale-value">1.00x</span>
        </div>
        <div class="field slider-field">
          <label for="heat-height">Height map scale</label>
          <input id="heat-height" type="range" min="1" max="6" step="0.2" value="3" />
          <span class="slider-value" id="heat-height-value">3.0x</span>
        </div>
        <div class="field slider-field">
          <label for="token-scale">Token size</label>
          <input id="token-scale" type="range" min="0.4" max="2.5" step="0.05" value="1" />
          <span class="slider-value" id="token-scale-value">1.00x</span>
        </div>
        <div class="field slider-field">
          <label for="grid-font-scale">Grid ref font size</label>
          <input id="grid-font-scale" type="range" min="0.4" max="2" step="0.05" value="0.9" />
          <span class="slider-value" id="grid-font-scale-value">90%</span>
        </div>
        <div class="field">
          <label><input type="checkbox" id="arena-grid" /> Show XYZ arena grid</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="show-texture" checked /> Show texture map</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="show-height" checked /> Show height map</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="show-overlay-grid" checked /> Show overlay grid/hex</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="show-overlay-labels" checked /> Show grid refs (A0...)</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="show-models" checked /> Show 3D models on tokens</label>
        </div>
        <div class="field stats-field">
          <div class="stats-label">Runtime stats</div>
          <div id="runtime-stats" class="stats-value">heap -- | tex -- | geo --</div>
        </div>
      </div>
      <div class="params-window-resize" aria-label="Resize"></div>
    </div>

    <div id="selection-window" class="selection-window">
      <div class="selection-window-header">
        <span>Selection</span>
        <div class="selection-actions">
          <button id="selection-clear">Clear</button>
        </div>
        <button id="selection-close">Close</button>
      </div>
      <div class="selection-body">
        <div class="selection-actions-row">
          <button id="selection-road">Roads</button>
          <button id="selection-raise">Raise Height</button>
          <button id="selection-lower">Lower Height</button>
          <button id="selection-zero">Zero Height</button>
          <button id="selection-export">Make Height Map</button>
        </div>
        <textarea id="selection-text" spellcheck="false"></textarea>
      </div>
      <div class="selection-window-resize" aria-label="Resize selection window"></div>
    </div>

    <script type="module" src="app/app.js"></script>
  </body>
</html>
